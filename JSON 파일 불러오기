# JSON íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°

import os
import glob
import pandas as pd

folder_path = "C:/Users/Admin/Desktop/Final_Project/Sample/Sample/2.ë¼ë²¨ë§ë°ì´í„°"  # JSON íŒŒì¼ë“¤ì´ ìˆëŠ” í´ë” ê²½ë¡œ

# í´ë” ê²½ë¡œ í™•ì¸
if not os.path.exists(folder_path):
    print(f"í´ë” ê²½ë¡œê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤: {folder_path}")
    exit()

json_files = sorted(glob.glob(os.path.join(folder_path, "*.json")))  # íŒŒì¼ ëª©ë¡ ì •ë ¬

# JSON íŒŒì¼ì´ í•˜ë‚˜ë„ ì—†ì„ ê²½ìš°
if not json_files:
    print("JSON íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.")
    exit()

dataframes = []
for file in json_files:
    try:
        df = pd.read_json(file)
        
        # íŒŒì¼ì´ ë¹„ì–´ìˆëŠ” ê²½ìš° ì²˜ë¦¬
        if df.empty:
            print(f"{file} íŒŒì¼ì€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.")
        else:
            df["filename"] = os.path.basename(file)  # íŒŒì¼ ì´ë¦„ ì¶”ê°€
            dataframes.append(df)
    
    except ValueError as e:
        print(f"íŒŒì¼ì´ ì˜ëª»ëœ JSON í˜•ì‹ì…ë‹ˆë‹¤: {file}, ì˜¤ë¥˜: {e}")
    except Exception as e:
        print(f"íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {file}, ì˜¤ë¥˜: {e}")

# ë°ì´í„°í”„ë ˆì„ ë³‘í•© í›„ ì¤‘ë³µ ì²˜ë¦¬
if dataframes:
    json_df = pd.concat(dataframes, ignore_index=True)
    
    # dict íƒ€ì…ì˜ ì—´ì´ ìˆì„ ê²½ìš°, ë¬¸ìì—´ë¡œ ë³€í™˜
    for col in json_df.select_dtypes(include=['object']).columns:
        json_df[col] = json_df[col].apply(lambda x: str(x) if isinstance(x, dict) else x)
    
    json_df = json_df.drop_duplicates()  # ì¤‘ë³µ ì œê±°
    print(f"ëª¨ë“  JSON íŒŒì¼ì„ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤. ì´ {len(dataframes)}ê°œì˜ íŒŒì¼ì„ ì²˜ë¦¬í–ˆìŠµë‹ˆë‹¤.")
    
    # âœ… JSON ë°ì´í„° ë¯¸ë¦¬ë³´ê¸° ì¶”ê°€ âœ…
    print("\nğŸ“Œ JSON ë°ì´í„° ìƒ˜í”Œ (ìƒìœ„ 5ê°œ í–‰)")
    print(json_df.head())  # ìƒìœ„ 5ê°œ í–‰ ì¶œë ¥
    
else:
    print("ì²˜ë¦¬ëœ JSON íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.")
